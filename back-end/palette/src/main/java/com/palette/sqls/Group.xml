<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.palette.dao.GroupDao">

	<resultMap type="com.palette.model.GroupSchedule" id="GroupSchedule">
		<id column="GROUP_SCHEDULE_SEQ" property="groupScheduleSeq"/>
		<result column="GROUP_INFO_SEQ" property="groupInfoSeq"/>
		<result column="SUNDAY" property="sunday"/>
		<result column="MONDAY" property="monday"/>
		<result column="TUESDAY" property="tuesday"/>
		<result column="WEDNESDAY" property="wednesday"/>
		<result column="THURSDAY" property="thursday"/>
		<result column="FRIDAY" property="friday"/>
		<result column="SATURDAY" property="saturday"/>
	</resultMap>

	<resultMap type="com.palette.model.InterBigDto" id="InterBig">
		<id column="INTER_BIG_SEQ" property="interBigSeq"/>
		<result column="BIG_NAME" property="bigName"/>
	</resultMap>
	<resultMap type="com.palette.model.InterSmallDto" id="InterSmall">
		<id column="INTER_SMALL_SEQ" property="interSmallSeq"/>
		<result column="INTER_BIG_SEQ" property="interBigSeq"/>
		<result column="SMALL_NAME" property="smallName"/>
	</resultMap>
	
	<resultMap type="com.palette.model.MemberDto" id="MemberInfo">
		<id column="MEMBER_SEQ" property="memberSeq"/>
		<result column="MEMBER_ID" property="memberId"/>
		<result column="MEMBER_NAME" property="memberName"/>
		<result column="BIRTH" property="birth"/>
		<result column="ADDRESS" property="address"/>
		<result column="LOCATION" property="location"/>
		<result column="EMAIL" property="email"/>
		<result column="MYMONEY" property="myMoney"/>
		<result column="CV" property="cv"/>
		<result column="AUTH" property="auth"/>
		<result column="DEL" property="del"/>
		<result column="DISLIKE" property="dislike"/>
	</resultMap> 

<!-- GroupList = GroupDto + InterBig, InterSmall, MemberDto(leader)  -->
	<resultMap type="com.palette.model.GroupDto" id="GroupList">
		<id column="GROUP_INFO_SEQ" property="groupInfoSeq"/>
		<result column="MEMBER_SEQ" property="memberSeq"/>
		<result column="INTER_BIG_SEQ" property="interBigSeq"/>
		<result column="INTER_SMALL_SEQ" property="interSmallSeq"/>
		<result column="GROUP_NAME" property="groupName"/>
		<result column="INFO" property="info"/>
		<result column="MAX_MEMBER" property="maxMember"/>
		<result column="IMAGE" property="image"/>
		<result column="START_DATE" property="startDate"/>
		<result column="END_DATE" property="endDate"/>
		<result column="DEL" property="del"/>
		<result column="CURR_MEMBER" property="currMember"/>
		<collection property="interBigDto" resultMap="InterBig"/>
		<collection property="interSmallDto" resultMap="InterSmall"/>
		<collection property="memberDto" resultMap="MemberInfo"/>
	</resultMap>
	
<!-- GroupDetail = GroupDto + ( GroupSchedule, InterBig, InterSmall, MemberDto(count) ) -->
	<resultMap type="com.palette.model.GroupDto" id="GroupInfo">
		<id column="GROUP_INFO_SEQ" property="groupInfoSeq"/>
		<result column="MEMBER_SEQ" property="memberSeq"/>
		<result column="INTER_BIG_SEQ" property="interBigSeq"/>
		<result column="INTER_SMALL_SEQ" property="interSmallSeq"/>
		<result column="GROUP_NAME" property="groupName"/>
		<result column="INFO" property="info"/>
		<result column="MAX_MEMBER" property="maxMember"/>
		<result column="IMAGE" property="image"/>
		<result column="START_DATE" property="startDate"/>
		<result column="END_DATE" property="endDate"/>
		<result column="DEL" property="del"/>
		<result column="CURR_MEMBER" property="currMember"/>
		<collection property="groupSchedule" resultMap="GroupSchedule"/>
		<collection property="interBigDto" resultMap="InterBig"/>
		<collection property="interSmallDto" resultMap="InterSmall"/>
		<collection property="memberDto" resultMap="MemberInfo"/>
	</resultMap>


<select id="getAllGroup" resultMap="GroupList">
	select *
	from GROUP_INFO g
	join MEMBER m
		on g.MEMBER_SEQ = m.MEMBER_SEQ
	join INTER_BIG ib
		on g.INTER_BIG_SEQ = ib.INTER_BIG_SEQ
	join INTER_SMALL ism
		on g.INTER_SMALL_SEQ = ism.INTER_SMALL_SEQ
	join (select GROUP_INFO_SEQ, count(*) as CURR_MEMBER
			from GROUP_MEMBER
			group by GROUP_INFO_SEQ) cur
		on g.GROUP_INFO_SEQ = cur.GROUP_INFO_SEQ;
</select>

 <select id="getOneGroup" parameterType="java.lang.Integer" resultMap="GroupInfo">
    select *
	from GROUP_INFO g
	join MEMBER m
		on g.MEMBER_SEQ = m.MEMBER_SEQ
	join INTER_BIG ib
		on g.INTER_BIG_SEQ = ib.INTER_BIG_SEQ
	join INTER_SMALL ism
		on g.INTER_SMALL_SEQ = ism.INTER_SMALL_SEQ
	join GROUP_SCHEDULE s
		on g.GROUP_INFO_SEQ = s.GROUP_INFO_SEQ
	join (select GROUP_INFO_SEQ, count(*) as CURR_MEMBER
			from GROUP_MEMBER
			group by GROUP_INFO_SEQ) cur
		on g.GROUP_INFO_SEQ = cur.GROUP_INFO_SEQ
	where g.GROUP_INFO_SEQ = #{seq};
</select>
 
<!-- <select id="getGroupMemberName" parameterType="java.lang.Integer" resultMap="GroupMember">
	SELECT g.GROUP_INFO_SEQ, g.MEMBER_SEQ, m.MEMBER_ID, m.MEMBER_NAME, m.BIRTH, m.ADDRESS, m.LOCATION, m.EMAIL, m.MYMONEY, m.CV, m.AUTH, m.DISLIKE
      FROM GROUP_MEMBER g
	  JOIN MEMBER m
	    ON g.MEMBER_SEQ = m.MEMBER_SEQ 
	 WHERE g.GROUP_INFO_SEQ = #{seq}
</select> -->

<select id="getgroupBoardList" resultType="com.palette.model.GroupBoardDto">
	select 
	from BOARD b
	join MEMBER m
	on b.MEMBER_SEQ = m.MEMBER_SEQ
</select>


<!-- <select id="bbsPagingList" parameterType="bit.com.a.model.BbsParam" resultType="bit.com.a.model.BbsDto">
SELECT LNUM, RNUM, ID, TITLE, CONTENT, WDATE, DEL, READCOUNT
FROM ( SELECT ROW_NUMBER()OVER(ORDER BY RNUM DESC) AS LNUM,
			  RNUM, ID, REF, STEP, DEPTH, TITLE, CONTENT, WDATE, DEL, READCOUNT
       FROM ( SELECT ROW_NUMBER()OVER(ORDER BY REF, STEP DESC) AS RNUM,
                     SEQ, ID, REF, STEP, DEPTH, TITLE, CONTENT, WDATE, DEL, READCOUNT
              FROM BBS
              WHERE 1=1
	   			  <if test="choice == 'title'">
					  AND	TITLE LIKE '%'||#{searchWord}||'%'
				  </if>
				  <if test="choice == 'content'">
					  AND CONTENT LIKE '%'||#{searchWord}||'%'
				  </if>
				  <if test="choice == 'writer'">
					  AND ID = #{searchWord}
				  </if>
	   				  ORDER BY REF DESC, STEP ASC))
<![CDATA[ WHERE LNUM >= ${start} AND LNUM <=${end} ]]>
	
</select> -->





<select id="getBigList" resultType="com.palette.model.InterBigDto">
  SELECT * FROM INTER_BIG
</select>

<select id="getSmallList" parameterType="java.lang.Integer" resultType="com.palette.model.InterSmallDto">
  SELECT * FROM INTER_SMALL WHERE INTER_BIG_SEQ = #{seq}
</select>
</mapper>